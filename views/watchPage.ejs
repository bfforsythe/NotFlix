
<%- include('./partials/head.ejs') %>
<head>
    <style>
        Body {
            background-image: none;
            background-color: aqua;
        }
        .desc {
        width: 100%;
        height: flex;
        border-style: solid;
        border-width: 2px;
        }
    </style>
</head>

<body>

<form id="redirectMe" action="/goHome" method="post" type="hidden"></form>

<div class="center">
    <div style="text-align: center; font-size: 20;" name="title"><%= vidData.title  %></div>
    <div name="video">
        <a referrerpolicy="origin-when-cross-origin">
            <div id="player"></div>
        </a>
    </div>
    <div class="desc">
        <div>
            <div style="width: 50%; height: 40px; float: left;" name="genre">Genre: <%= vidData.genre %></div>
            <% if(user.accountType == "marketing") {%>
            <div style="margin-left: 50%; height: 40px;" name="views">Views: <%= vidData.views %></div>
            <% }else{ %>
            <br><br>
            <% } %>
        </div>
        <div style="width: flex;" name="description">Description: <%= vidData.description %></div>
    </div>
</div>
</body>

<script>
    var lastInteration = Date.now();
    document.addEventListener("click",resetTimer);
    document.addEventListener("keydown",resetTimer);
    var state;
    var logoutTime = 300000;

    function resetTimer(){
        lastInteration = Date.now();
    }

    function checkActivity(){
        var state = player.getPlayerState();
        if(Date.now() - lastInteration > logoutTime && state != 1 && state != 3){
            document.getElementById("redirectMe").submit();
        }
    }

    var tag = document.createElement('script');

      tag.src = "https://www.youtube.com/iframe_api";
      var firstScriptTag = document.getElementsByTagName('script')[0];
      firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

    var player;
    function onYouTubeIframeAPIReady() {
        player = new YT.Player('player', {
            height: '390',
            width: '640',
            videoId: '<%- vidData.url %>',
            playerVars: {
            'playsinline': 1,
            'enablejsapi':1
            },
            events: {
            'onReady': onPlayerReady,
            'onStateChange': onPlayerStateChange
            }
        });
    }
    function onPlayerReady(event) {
       // event.target.playVideo();
    }


    function onPlayerStateChange(event) {
       resetTimer();
    }

    setInterval(checkActivity,1000);
</script>

