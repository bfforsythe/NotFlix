<!-- Loop a function that adds continuous images based on how many urls they are
     the urls function as hyperlinks to an image, on click redirect to watchPage, easy. -->
<style>
    Body {
        background: rgb(45,160,184);
        background: linear-gradient( rgba(45,160,184,1) 2%, rgba(2,0,36,0.7792366946778712) 16%, rgba(9,115,121,1) 92%);
        }
        .slideshow-group {
        display: flex;
        justify-content: center;
        }
</style>
<head>
    <title>Browsing Page</title>
</head>
<%- include('./partials/carousel.ejs') %>

<body>
    <% let maxMovies = 100 %>
    <% let videoWidth = 200 %>
    <% let videoHeight = 100 %>
    <%- include('./partials/nav.ejs') %>
    <%- include('./partials/userCheck.ejs') %>

    <center>
    <input type="text" id="search"> Search </input>
    <button type="submit" onclick="searchMovies()"> Search</button>
    </center>
<!-- Begin Slideshow Containers
            Brandon Forsythe, 2023
      
      All containers will initialize 100 empty spots to be filled by functions below
      and will display 4 elements at a time, controlled by the arrows on each side of slides.
-->
    
  <div id="search-results"></div>

    <div id="action-slides" class="slideshow-container">
      <p1>Action</p1>
        <% for (let i = 0; i < newMovieGenres.Action.length; i += maxMovies) { %>
          <div class="slideshow-group">
            <% for (let j = i; j < i + 100 && j < newMovieGenres.Action.length; j++) { %>
                <div class="mySlides fade">
                        <img height="<%= videoHeight %>px" width="<%= videoWidth %>px" src="https://i.ytimg.com/vi/<%= newMovieGenres.Action[j] %>/maxresdefault.jpg" onclick="storeURL('<%= newMovieGenres.Action[j] %>')">
                    </div>  
            <% } %>
          
        <% } %>
        <a class="prev" onclick="plusSlides(-1, slideshow1)">❮</a>
        <a class="next" onclick="plusSlides(1, slideshow1)">❯</a>
      </div>
    </div>

      <!-- Horror Slides -->

      
      <div id="horror-slides" class="slideshow-container">
        <p1> Horror </p1>
        <% for (let i = 0; i < newMovieGenres.Horror.length; i += maxMovies) { %>
          <div class="slideshow-group">
            <% for (let j = i; j < i + 100 && j < newMovieGenres.Horror.length; j++) { %>
                <div class="mySlides fade">
                        <img height="<%= videoHeight %>px" width="<%= videoWidth %>px" src="https://i.ytimg.com/vi/<%= newMovieGenres.Horror[j] %>/maxresdefault.jpg" onclick="storeURL('<%= newMovieGenres.Horror[j] %>')">
                    </div>  
            <% } %>
          
        <% } %>
        <a class="prev" onclick="plusSlides(-1,slideshow2)">❮</a>
        <a class="next" onclick="plusSlides(1,slideshow2)">❯</a>
        </div>
      </div>

      <!-- Romance Slides -->

      
      <div id="romance-slides" class="slideshow-container">
        <p1> Romance </p1>
        <% for (let i = 0; i < newMovieGenres.Romance.length; i += maxMovies) { %>
          <div class="slideshow-group">
            <% for (let j = i; j < i + 100 && j < newMovieGenres.Romance.length; j++) { %>
                <div class="mySlides fade">
                        <img height="<%= videoHeight %>px" width="<%= videoWidth %>px" src="https://i.ytimg.com/vi/<%= newMovieGenres.Romance[j] %>/maxresdefault.jpg" onclick="storeURL('<%= newMovieGenres.Romance[j] %>')">
                    </div>  
            <% } %>
          
        <% } %>
        <center>
        <a class="prev" onclick="plusSlides(-1,slideshow3)">❮</a>
        <a class="next" onclick="plusSlides(1,slideshow3)">❯</a>
      </center>
        </div>
      </div>


</body>


<script>

/* function storeURL
 ------------------------------
  this function takes the url chosen from the browsing page
  and redirects the user to a watch page with the unique URL identifier

*/
function storeURL(url) {
    localStorage.setItem("retrievedURL", url);
    console.log("URL STORED!", url);
    const newUrl = `/watchPage/${url}`;
    window.location.href = newUrl;
}

// initialize slideshows

var slideshow1 = document.getElementById("action-slides");
  slideshow1.currentSlideIndex = 1;
  showSlides(slideshow1.currentSlideIndex, slideshow1);
  
  var slideshow2 = document.getElementById("horror-slides");
  slideshow2.currentSlideIndex = 1;
  showSlides(slideshow2.currentSlideIndex, slideshow2);
  
  var slideshow3 = document.getElementById("romance-slides");
  slideshow3.currentSlideIndex = 1;
  showSlides(slideshow3.currentSlideIndex, slideshow3);
  
  
  /*
    function plusSlides
    --------------------
    this is the controller for the arrows.
    on click will move the slides that determined number of slides forward.
  
  */
  function plusSlides(n, slideshow) {
    showSlides(slideshow.currentSlideIndex += n, slideshow);
    console.log("MOVING SLIDES!!!!");
  }
  
  function currentSlide(n, slideshow) {
    showSlides(slideshow.currentSlideIndex = n, slideshow);
  }
  
  
  
function showSlides(n, slideshow) {
  slideshow.currentSlideIndex = n;
  var i;
  var slides = slideshow.getElementsByClassName("mySlides");
  var startIndex = (n - 1) * 4;
  var endIndex = startIndex + 4;
  if (endIndex > slides.length) {
    endIndex = slides.length;
    startIndex = endIndex - 4;
  }
  for (i = 0; i < slides.length; i++) {
    if (i >= startIndex && i < endIndex) {
      slides[i].style.display = "block";
    } else {
      slides[i].style.display = "none";
    }
  }
}

  var searchInput = document.getElementById("search");
  function searchMovies() {

    var slideshowContainers = document.getElementsByClassName("slideshow-container");
    const searchResultsContainer = document.getElementById('search-results');
    while (searchResultsContainer.firstChild) {
      searchResultsContainer.removeChild(searchResultsContainer.firstChild);
    }

    if (searchInput.value !== "") {
      for (var i = 0; i < slideshowContainers.length; i++) {
        slideshowContainers[i].style.display = "none";
      }

      <% for(i = 0; i < urlData.length; i++){ %>

        var searchTitles = "<%= urlData[i].title.toLowerCase()%>" ;

        if("<%=urlData[i].title%>".includes(searchInput.value)){
          console.log("FOUND!", "<%=urlData[i].title%>");
          const searchResult = document.createElement('img');
          searchResult.height = 200;
          searchResult.width = 300;
          var resultString = "https://i.ytimg.com/vi/" + "<%=urlData[i].url%>" + "/maxresdefault.jpg";
          searchResult.src=resultString;

          searchResultsContainer.appendChild(searchResult);
        }
     <% } %>
    } else {
      for (var i = 0; i < slideshowContainers.length; i++) {
        slideshowContainers[i].style.display = "block";
      }
    }
  }


</script>